<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Cesar Taconeli" />


<title>Besouros da farinha</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Gian Lima</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://gianlima.github.io/">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GLM 1-9
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Conteúdo de GLM</li>
    <li class="dropdown-header">Módulo 2 - Revisão de modelos lineares</li>
    <li>
      <a href="reacao_mod2.html">Reação química + tipos de embalagens (Modelo com erros normais)</a>
    </li>
    <li>
      <a href="venda_cos_mod2.html">Vendas de cosméticos (Modelo com erros normais)</a>
    </li>
    <li>
      <a href="min_qua_pon_mod3.html">Módulo 3 - Modelo linear com erros heterocedásticos</a>
    </li>
    <li class="dropdown-header">Módulo 6 - Estimação em modelos lineares generalizados</li>
    <li>
      <a href="estim_glm_mod6.html">Estimação em modelos lineares generalizados</a>
    </li>
    <li>
      <a href="sini_auto_mod6.html">Sinistros de Automóveis (Dados de contagens)</a>
    </li>
    <li>
      <a href="aval_qua_mod8.html">Módulo 8 - Análise de deviance</a>
    </li>
    <li>
      <a href="sel_var_mod9.html">Módulo 9 - Seleção de covariáveis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GLM 10-15
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="diag_mod10.html">Módulo 10 - Diagnóstico do ajuste de MLGs</a>
    </li>
    <li class="dropdown-header">Módulo 11 - Regressão para dados binários</li>
    <li>
      <a href="besouro_mod11.html">Auditoria</a>
    </li>
    <li>
      <a href="besouro_mod11.html">Besouro da Farinha</a>
    </li>
    <li>
      <a href="estimacao_mod11.html">Estimação em MLG usando bootstrap</a>
    </li>
    <li>
      <a href="plebis_mod11.html">Plebiscito no Chile</a>
    </li>
    <li class="dropdown-header">Módulo 12 - Regressão para dados binários - predição</li>
    <li>
      <a href="credito_mod12.html">Análise de risco de crédito</a>
    </li>
    <li>
      <a href="base_mod12.html">Base de dados sobre spams</a>
    </li>
    <li class="dropdown-header">Módulo 13 - Regressão para dados de contagens</li>
    <li>
      <a href="queda_idoso_mod13.html">Quedas de idosos</a>
    </li>
    <li>
      <a href="cromo_mod13.html">Cromossomos anormais (Regressão Poisson com termo offset)</a>
    </li>
    <li class="dropdown-header">Módulo 14 - Regressão para dados de contagens com super dispersão</li>
    <li>
      <a href="super_disp_mod14.html">superdispersão (simulação)</a>
    </li>
    <li>
      <a href="exe_comp_mod14.html">Executivos compartilhados</a>
    </li>
    <li>
      <a href="Consulta_mod14.html">Número de consultas ao médico (Austrália)</a>
    </li>
    <li>
      <a href="ratos_mod14.html">Suplementação de ferro em ratos</a>
    </li>
    <li>
      <a href="cevada_mod14.html">Doença da cevada</a>
    </li>
    <li class="dropdown-header">Módulo 15 - Regressão para dados contínuos assimétricos</li>
    <li>
      <a href="turbina_mod15.html">Tempo de vida de turbinas de avião</a>
    </li>
    <li>
      <a href="tweedie_valor_sin_mod15.html">Valor de sinistros</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/gianlima/r-exams-tutorial">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Besouros da farinha</h1>
<h4 class="author">Cesar Taconeli</h4>

</div>


<p>Regressão para dados binários</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">require</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">require</span>(car)</a></code></pre></div>
<div id="exemplo-2" class="section level2">
<h2>Exemplo 2</h2>
<p>Dados de mum experimento do tipo dose-resposta, referente à mortalidade de besouros sob três tratamentos (DDT, BHC e DDT+BHC), sob seis diferentes doses.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">ldose &lt;-<span class="st"> </span><span class="kw">log</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">2.64</span>, <span class="fl">3.48</span>, <span class="fl">4.59</span>, <span class="fl">6.06</span>, <span class="dv">8</span>), <span class="dv">3</span>)) <span class="co">### log-dose</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">Trat &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&#39;DDT&#39;</span>, <span class="st">&#39;BHC&#39;</span>, <span class="st">&#39;DDT+BHC&#39;</span>), <span class="dt">each =</span> <span class="dv">6</span>) <span class="co">### tratamento</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">Resposta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">19</span>, <span class="dv">19</span>, <span class="dv">24</span>, <span class="dv">35</span>, <span class="dv">2</span>, <span class="dv">14</span>, <span class="dv">20</span>, <span class="dv">27</span>, <span class="dv">41</span>, <span class="dv">40</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">46</span>, <span class="dv">48</span>, <span class="dv">48</span>, <span class="dv">50</span>)</a></code></pre></div>
<p>Número de insetos mortos sob cada condição experimental.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">49</span>, <span class="dv">47</span>, <span class="dv">50</span>, <span class="dv">49</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">49</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="dv">50</span>)</a></code></pre></div>
<p>Número de insetos submetidos a cada condição experimental.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">dados &lt;-<span class="st"> </span><span class="kw">data.frame</span>(ldose,Trat,Resposta,n)</a></code></pre></div>
<p>Análise descritiva</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">g0 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dados, <span class="kw">aes</span>(<span class="dt">x =</span> ldose, <span class="dt">y =</span> Resposta<span class="op">/</span>n, <span class="dt">color=</span>Trat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">18</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Dose(log)&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Proporção de insetos mortos&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;top&quot;</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">g0</a></code></pre></div>
<p><img src="besouro_mod11_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="parte-1" class="section level2">
<h2>Parte 1</h2>
<p>Vamos começar ajustando um modelo apenas para os insetos tratados com BHC</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">data_BCH &lt;-<span class="st"> </span><span class="kw">subset</span>(dados, Trat<span class="op">==</span><span class="st">&#39;BHC&#39;</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">g1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data_BCH, <span class="kw">aes</span>(<span class="dt">x =</span> ldose, <span class="dt">y =</span> Resposta<span class="op">/</span>n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">18</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Dose(log)&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Proporção de insetos mortos&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;top&quot;</span>)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">g1</a></code></pre></div>
<p><img src="besouro_mod11_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="modelo-com-função-de-ligação-logito" class="section level2">
<h2>Modelo com função de ligação logito</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">ajuste1 &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">cbind</span>(Resposta, n<span class="op">-</span>Resposta) <span class="op">~</span><span class="st"> </span>ldose, <span class="dt">family =</span> binomial, </a>
<a class="sourceLine" id="cb7-2" data-line-number="2">               <span class="dt">data =</span> data_BCH)</a></code></pre></div>
<p>A primeira forma de declarar a resposta quando temos um glm binomial com dados grupados é por umja matriz com duas colunas, cada uma delas com as contagens de um dos desfechos binários (insetos mortos e não mortos, no caso).</p>
<p>Forma alternativa:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">ajuste1_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">glm</span>(Resposta<span class="op">/</span>n <span class="op">~</span><span class="st"> </span>ldose, <span class="dt">family =</span> binomial, <span class="dt">data =</span> data_BCH, <span class="dt">weights =</span> n) </a></code></pre></div>
<p>Neste caso, declaramos a resposta como a fração de insetos mortos, e o número de insetos mortos é declarado em weights.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">summary</span>(ajuste1)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(Resposta, n - Resposta) ~ ldose, family = binomial, 
##     data = data_BCH)
## 
## Deviance Residuals: 
##       7        8        9       10       11       12  
## -1.8245   1.1416   0.3390  -0.4281   1.2679  -1.2728  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -4.0428     0.4972  -8.131 4.27e-16 ***
## ldose         2.8381     0.3392   8.367  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 105.1973  on 5  degrees of freedom
## Residual deviance:   8.1581  on 4  degrees of freedom
## AIC: 35.376
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">summary</span>(ajuste1_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Resposta/n ~ ldose, family = binomial, data = data_BCH, 
##     weights = n)
## 
## Deviance Residuals: 
##       7        8        9       10       11       12  
## -1.8245   1.1416   0.3390  -0.4281   1.2679  -1.2728  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -4.0428     0.4972  -8.131 4.27e-16 ***
## ldose         2.8381     0.3392   8.367  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 105.1973  on 5  degrees of freedom
## Residual deviance:   8.1581  on 4  degrees of freedom
## AIC: 35.376
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Os modelos ajustados são rigorosamente os mesmos. Muda apenas a forma de declaração.</p>
<p>Exercício: Escreva a equação do modelo ajustado e calcule a estimativa da probabilidade de morte para insetos submetidos a uma dose de 7 unidades. Adicionalmente, interprete (se couber) os parâmetros do modelo.</p>
<p>Agora, vamos adicionar ao gráfico a curva referente ao modelo ajustado</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">grid_ldose &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">log</span>(<span class="dv">2</span>), <span class="kw">log</span>(<span class="dv">8</span>), <span class="fl">0.01</span>) <span class="co">### grid de valores para a (log) dose.</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">preditos &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste1, <span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">ldose =</span> grid_ldose), <span class="dt">type=</span><span class="st">&#39;response&#39;</span>)</a></code></pre></div>
<p>Probabilidades estimadas para as doses no grid que criamos</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">new.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(grid_ldose, preditos)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">g2 &lt;-<span class="st"> </span>g1 <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">data =</span> new.data, <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos),  </a>
<a class="sourceLine" id="cb14-4" data-line-number="4">                     <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">g2</a></code></pre></div>
<p><img src="besouro_mod11_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="modelo-com-função-de-ligação-probito" class="section level2">
<h2>Modelo com função de ligação probito</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">ajuste2 &lt;-<span class="st"> </span><span class="kw">glm</span>(Resposta<span class="op">/</span>n <span class="op">~</span><span class="st"> </span>ldose, <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&#39;probit&#39;</span>), </a>
<a class="sourceLine" id="cb15-2" data-line-number="2">               <span class="dt">data =</span> data_BCH, <span class="dt">weights =</span> n)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">summary</span>(ajuste2) </a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Resposta/n ~ ldose, family = binomial(link = &quot;probit&quot;), 
##     data = data_BCH, weights = n)
## 
## Deviance Residuals: 
##       7        8        9       10       11       12  
## -1.6900   1.1213   0.3137  -0.3505   1.3744  -1.3053  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -2.4373     0.2764  -8.817   &lt;2e-16 ***
## ldose         1.7062     0.1881   9.069   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 105.1973  on 5  degrees of freedom
## Residual deviance:   7.9272  on 4  degrees of freedom
## AIC: 35.145
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><strong>Exercício:</strong> Escreva a equação do modelo ajustado e calcule a estimativa da probabilidade de morte para insetos submetidos a uma dose de 7 unidades.</p>
<p>Adicionando ao gráfico a curva referente ao odelo ajustado</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">preditos2 &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste2, <span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">ldose =</span> grid_ldose), <span class="dt">type=</span><span class="st">&#39;response&#39;</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">new.data2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(grid_ldose, preditos2)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">g3 &lt;-<span class="st"> </span>g2 <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">data =</span> new.data2, <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos2),  </a>
<a class="sourceLine" id="cb17-5" data-line-number="5">                     <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">g3</a></code></pre></div>
<p><img src="besouro_mod11_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="modelo-com-função-de-ligação-complemento-log-log" class="section level2">
<h2>Modelo com função de ligação complemento log-log</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">ajuste3 &lt;-<span class="st"> </span><span class="kw">glm</span>(Resposta<span class="op">/</span>n <span class="op">~</span><span class="st"> </span>ldose, <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&#39;cloglog&#39;</span>), </a>
<a class="sourceLine" id="cb18-2" data-line-number="2">               <span class="dt">data =</span> data_BCH, <span class="dt">weights =</span> n)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="kw">summary</span>(ajuste3) </a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Resposta/n ~ ldose, family = binomial(link = &quot;cloglog&quot;), 
##     data = data_BCH, weights = n)
## 
## Deviance Residuals: 
##       7        8        9       10       11       12  
## -2.4988   0.8083   0.5615   0.1727   1.7142  -1.5676  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -3.1170     0.3562  -8.751   &lt;2e-16 ***
## ldose         1.8570     0.2166   8.575   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 105.197  on 5  degrees of freedom
## Residual deviance:  12.638  on 4  degrees of freedom
## AIC: 39.856
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p><strong>Exercício:</strong> Escreva a equação do modelo ajustado e calcule a estimativa da probabilidade de morte para insetos submetidos a uma dose de 7 unidades.</p>
<p>Adicionando ao gráfico a curva referente ao odelo ajustado</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">preditos3 &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste3, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">ldose =</span> grid_ldose), <span class="dt">type=</span><span class="st">&#39;response&#39;</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">new.data3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(grid_ldose, preditos3)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"></a>
<a class="sourceLine" id="cb20-4" data-line-number="4">g4 &lt;-<span class="st"> </span>g3 <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">data =</span> new.data3, <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos3),  </a>
<a class="sourceLine" id="cb20-5" data-line-number="5">                     <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;green&#39;</span>)</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">g4</a></code></pre></div>
<p><img src="besouro_mod11_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="aic" class="section level2">
<h2>AIC</h2>
<p>Vamos comparar os ajustes dos três modelos calculando os respectivos AICs.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">AIC</span>(ajuste1, ajuste2, ajuste3)</a></code></pre></div>
<pre><code>##         df      AIC
## ajuste1  2 35.37617
## ajuste2  2 35.14529
## ajuste3  2 39.85641</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">c</span>(<span class="kw">logLik</span>(ajuste1), <span class="kw">logLik</span>(ajuste2), <span class="kw">logLik</span>(ajuste3)) </a></code></pre></div>
<pre><code>## [1] -15.68809 -15.57264 -17.92820</code></pre>
<p>Log-verossimilhanças maximizadas.</p>
<p>O modelo com ligação probito é ligeiramente superior ao com ligação logito. O modelo cloglog claramente tem pior ajuste que seus concorrentes.</p>
<p>E se ao invés de analisarmos os dados da forma como estão disponíveis (grupados) analisarmos na forma não grupada (ou seja, um inseto por linha)? Vamos construir uma nova base.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">data_BCH2 &lt;-<span class="st"> </span>data_BCH[<span class="kw">rep</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(data_BCH)), <span class="dt">times=</span>data_BCH<span class="op">$</span>n),<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">respostas &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rbind</span>(data_BCH<span class="op">$</span>Resposta, data_BCH<span class="op">$</span>n <span class="op">-</span><span class="st"> </span>data_BCH<span class="op">$</span>Resposta)) </a>
<a class="sourceLine" id="cb25-3" data-line-number="3">data_BCH2<span class="op">$</span>resp_bin &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="dt">times =</span> respostas)</a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="kw">head</span>(data_BCH2, <span class="dv">20</span>)</a></code></pre></div>
<pre><code>##          ldose Trat resp_bin
## 7    0.6931472  BHC        1
## 7.1  0.6931472  BHC        1
## 7.2  0.6931472  BHC        0
## 7.3  0.6931472  BHC        0
## 7.4  0.6931472  BHC        0
## 7.5  0.6931472  BHC        0
## 7.6  0.6931472  BHC        0
## 7.7  0.6931472  BHC        0
## 7.8  0.6931472  BHC        0
## 7.9  0.6931472  BHC        0
## 7.10 0.6931472  BHC        0
## 7.11 0.6931472  BHC        0
## 7.12 0.6931472  BHC        0
## 7.13 0.6931472  BHC        0
## 7.14 0.6931472  BHC        0
## 7.15 0.6931472  BHC        0
## 7.16 0.6931472  BHC        0
## 7.17 0.6931472  BHC        0
## 7.18 0.6931472  BHC        0
## 7.19 0.6931472  BHC        0</code></pre>
<p>data_BCH2 é a base de dados desagregados. Agora, cada linha da base é o dado de um único besouro, e a resposta é 1, para os insetos mortos, e zero, para os vivos.</p>
<p>Vamos ajustar o modelo de regressão binomial com ligação logito à base de dados desagregada.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">ajuste1_desag &lt;-<span class="st"> </span><span class="kw">glm</span>(resp_bin <span class="op">~</span><span class="st"> </span>ldose, <span class="dt">family =</span> binomial, <span class="dt">data =</span> data_BCH2) </a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">summary</span>(ajuste1_desag)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = resp_bin ~ ldose, family = binomial, data = data_BCH2)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0018  -0.6981  -0.4862   0.7678   2.0947  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -4.0428     0.4972  -8.131 4.27e-16 ***
## ldose         2.8381     0.3392   8.367  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 414.10  on 298  degrees of freedom
## Residual deviance: 317.06  on 297  degrees of freedom
## AIC: 321.06
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>E vamos comparar os ajustes dos modelos aplicados à base agregada e à base não agregada por meio das estimativas dos parâmetros e correspondentes erros padrões.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">compareCoefs</span>(ajuste1, ajuste1_desag)</a></code></pre></div>
<pre><code>## Calls:
## 1: glm(formula = cbind(Resposta, n - Resposta) ~ ldose, family = 
##   binomial, data = data_BCH)
## 2: glm(formula = resp_bin ~ ldose, family = binomial, data = data_BCH2)
## 
##             Model 1 Model 2
## (Intercept)  -4.043  -4.043
## SE            0.497   0.497
##                            
## ldose         2.838   2.838
## SE            0.339   0.339
## </code></pre>
<p>Observe que o modelo ajustado às duas bases é idêntico. Então, usar a base de dados agregada ou não agregada não altera o resultado do ajuste.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">logLik</span>(ajuste1)</a></code></pre></div>
<pre><code>## &#39;log Lik.&#39; -15.68809 (df=2)</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">logLik</span>(ajuste1_desag)</a></code></pre></div>
<pre><code>## &#39;log Lik.&#39; -158.529 (df=2)</code></pre>
<p>As escalas das verossimilhanças, no entanto, são diferentes. Em particular, o teste da qualidade do ajuste, baseado na deviance residual, se aplica aos dados agregados (para n grande), mas não aos dados desagregados. Vamos avaliar a qualidade do ajuste.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">pchisq</span>(<span class="kw">deviance</span>(ajuste1), <span class="dt">df =</span> ajuste1<span class="op">$</span>df.residual, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 0.08595524</code></pre>
<p>p-valor do teste da qualidade do ajuste. Ao nível de significância de 5% não temos evidência de que o modelo não se ajuste bem aos dados.</p>
<p>Exercício - Avaliar a qualidade dos ajustes com base nas deviances (teste ao nível de significância de 5%). Faça também qqplots com envelopes simulados.</p>
</div>
<div id="parte-2" class="section level2">
<h2>Parte 2</h2>
<p>Agora, vamos analisar os três tratamentos conjuntamente. Nesta<br />
etapa, vamos usar apenas a função de ligação logito</p>
<p>Gráfico de dispersão.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">h0 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dados, <span class="kw">aes</span>(<span class="dt">x =</span> ldose, <span class="dt">y =</span> Resposta<span class="op">/</span>n, <span class="dt">color=</span>Trat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="st">     </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">18</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">     </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Dose(log)&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Proporção de insetos mortos&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="st">     </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;top&quot;</span>)</a>
<a class="sourceLine" id="cb37-5" data-line-number="5">h0</a></code></pre></div>
<p><img src="besouro_mod11_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Conforme discutido em aula, vamos considerar três modelos, conforme descrito na sequência:</p>
<p>ajuste4 - Modelo de retas coincidentes - Sem considerar o efeito de tratamento. ajuste5 - Modelo de retas paralelas - Considerando o efeito de tratamento apenas no intercepto (modelo aditivo). ajuste6 - Modelo de retas concorrentes - Sem considerar o efeito de tratamento no intercepto e associado à dose (modelo multiplicativo - com efeito de interação)..</p>
</div>
<div id="modelo-de-retas-coincidentes" class="section level2">
<h2>Modelo de retas coincidentes</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">ajuste4 &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">cbind</span>(Resposta,n<span class="op">-</span>Resposta) <span class="op">~</span><span class="st"> </span>ldose, <span class="dt">family =</span> binomial, <span class="dt">data =</span> dados)</a></code></pre></div>
<p>Este é o modelo mais simples, em que ajustamos uma única reta (na escala do preditor, curva na escala da resposta) para os três tratamentos.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">summary</span>(ajuste4)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(Resposta, n - Resposta) ~ ldose, family = binomial, 
##     data = dados)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -4.336  -3.381  -1.384   4.024   6.301  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -2.4653     0.2386  -10.33   &lt;2e-16 ***
## ldose         2.0106     0.1703   11.81   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 413.65  on 17  degrees of freedom
## Residual deviance: 246.83  on 16  degrees of freedom
## AIC: 314.3
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>Adicionando o modelo ajustado ao gráfico.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">preditos4 &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste4, <span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">ldose =</span> grid_ldose), <span class="dt">type=</span><span class="st">&#39;response&#39;</span>)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">new.data4 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(grid_ldose, preditos4)</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"></a>
<a class="sourceLine" id="cb41-4" data-line-number="4">h1 &lt;-<span class="st"> </span>h0 <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">data =</span> new.data4, <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos4),  </a>
<a class="sourceLine" id="cb41-5" data-line-number="5">                     <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>)</a>
<a class="sourceLine" id="cb41-6" data-line-number="6">h1</a></code></pre></div>
<p><img src="besouro_mod11_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="modelo-de-retas-paralelas" class="section level2">
<h2>Modelo de retas paralelas</h2>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">ajuste5 &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">cbind</span>(Resposta,n<span class="op">-</span>Resposta) <span class="op">~</span><span class="st"> </span>ldose <span class="op">+</span><span class="st"> </span>Trat, <span class="dt">family =</span> binomial, <span class="dt">data =</span> dados)</a></code></pre></div>
<p>Este é o modelo intermediário (aditivo), em que ajustamos retas paralelas (na escala do preditor) para os três tratamentos.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">summary</span>(ajuste5)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(Resposta, n - Resposta) ~ ldose + Trat, family = binomial, 
##     data = dados)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0270  -0.6160  -0.2422   0.9016   2.6120  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -3.8425     0.3327 -11.550  &lt; 2e-16 ***
## ldose         2.6958     0.2157  12.498  &lt; 2e-16 ***
## TratDDT      -0.7128     0.1981  -3.598  0.00032 ***
## TratDDT+BHC   2.4177     0.2381  10.154  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 413.648  on 17  degrees of freedom
## Residual deviance:  21.282  on 14  degrees of freedom
## AIC: 92.753
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Agora, para predição precisamos de um grid de valores para cada inseticida. Vamos usar a função expand.grid para isso.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">trat &lt;-<span class="st"> </span><span class="kw">levels</span>(dados<span class="op">$</span>Trat)</a>
<a class="sourceLine" id="cb45-2" data-line-number="2">grid_trat &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(grid_ldose, trat)</a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="kw">names</span>(grid_trat) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;grid_ldose&quot;</span>, <span class="st">&quot;trat&quot;</span>)</a>
<a class="sourceLine" id="cb45-4" data-line-number="4">preditos5 &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste5, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">ldose =</span> grid_trat[,<span class="dv">1</span>], <span class="dt">Trat =</span> grid_trat[,<span class="dv">2</span>]), </a>
<a class="sourceLine" id="cb45-5" data-line-number="5">                     <span class="dt">type=</span><span class="st">&#39;response&#39;</span>)</a>
<a class="sourceLine" id="cb45-6" data-line-number="6">new.data5 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(grid_trat, preditos5)</a>
<a class="sourceLine" id="cb45-7" data-line-number="7"></a>
<a class="sourceLine" id="cb45-8" data-line-number="8">h0 <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">data =</span> <span class="kw">subset</span>(new.data5, trat <span class="op">==</span><span class="st"> &#39;BHC&#39;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos5),  </a>
<a class="sourceLine" id="cb45-9" data-line-number="9">               <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-10" data-line-number="10"><span class="st">     </span><span class="kw">geom_line</span>(<span class="dt">data =</span> <span class="kw">subset</span>(new.data5, trat <span class="op">==</span><span class="st"> &#39;DDT&#39;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos5),  </a>
<a class="sourceLine" id="cb45-11" data-line-number="11">               <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;green&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-12" data-line-number="12"><span class="st">     </span><span class="kw">geom_line</span>(<span class="dt">data =</span> <span class="kw">subset</span>(new.data5, trat <span class="op">==</span><span class="st"> &#39;DDT+BHC&#39;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos5),  </a>
<a class="sourceLine" id="cb45-13" data-line-number="13">               <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>)</a></code></pre></div>
<p><img src="besouro_mod11_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Adicionando as curvas de mortalidade vs dose para cada inseticida.</p>
</div>
<div id="modelo-de-retas-concorrentes" class="section level2">
<h2>Modelo de retas concorrentes</h2>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">ajuste6 &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">cbind</span>(Resposta, n<span class="op">-</span>Resposta) <span class="op">~</span><span class="st"> </span>ldose <span class="op">*</span><span class="st"> </span>Trat, <span class="dt">family =</span> binomial, <span class="dt">data =</span> dados)</a></code></pre></div>
<p>Este é o modelo mais completo (multiplicativo - com interação), em que ajustamos retas concorrentes (na escala do preditor) para os três tratamentos.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">summary</span>(ajuste6)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(Resposta, n - Resposta) ~ ldose * Trat, family = binomial, 
##     data = dados)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.82453  -0.78870  -0.05548   0.59419   2.24095  
## 
## Coefficients:
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)        -4.0428     0.4972  -8.131 4.27e-16 ***
## ldose               2.8381     0.3392   8.367  &lt; 2e-16 ***
## TratDDT             0.1278     0.7118   0.180   0.8575    
## TratDDT+BHC         1.9221     0.7722   2.489   0.0128 *  
## ldose:TratDDT      -0.5602     0.4680  -1.197   0.2313    
## ldose:TratDDT+BHC   0.5503     0.6662   0.826   0.4088    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 413.65  on 17  degrees of freedom
## Residual deviance:  17.89  on 12  degrees of freedom
## AIC: 93.361
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">preditos6 &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste6, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">ldose =</span> grid_trat[,<span class="dv">1</span>], <span class="dt">Trat =</span> grid_trat[,<span class="dv">2</span>]), <span class="dt">type=</span><span class="st">&#39;response&#39;</span>)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2">new.data6 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(grid_trat, preditos6)</a>
<a class="sourceLine" id="cb49-3" data-line-number="3"></a>
<a class="sourceLine" id="cb49-4" data-line-number="4">h0 <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">data =</span> <span class="kw">subset</span>(new.data6, trat <span class="op">==</span><span class="st"> &#39;BHC&#39;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos6),  </a>
<a class="sourceLine" id="cb49-5" data-line-number="5">               <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb49-6" data-line-number="6"><span class="st">     </span><span class="kw">geom_line</span>(<span class="dt">data =</span> <span class="kw">subset</span>(new.data6, trat <span class="op">==</span><span class="st"> &#39;DDT&#39;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos6),  </a>
<a class="sourceLine" id="cb49-7" data-line-number="7">               <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;green&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb49-8" data-line-number="8"><span class="st">     </span><span class="kw">geom_line</span>(<span class="dt">data =</span> <span class="kw">subset</span>(new.data6, trat <span class="op">==</span><span class="st"> &#39;DDT+BHC&#39;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> grid_ldose, <span class="dt">y =</span> preditos6),  </a>
<a class="sourceLine" id="cb49-9" data-line-number="9">               <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>)</a></code></pre></div>
<p><img src="besouro_mod11_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
<div id="comparação-dos-ajustes-dos-três-modelos" class="section level2">
<h2>Comparação dos ajustes dos três modelos</h2>
<p>Pelo fato dos três modelos serem encaixados, vamos compará-los usando o TRV.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw">anova</span>(ajuste4, ajuste5, ajuste6, <span class="dt">test =</span> <span class="st">&#39;Chisq&#39;</span>)</a></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: cbind(Resposta, n - Resposta) ~ ldose
## Model 2: cbind(Resposta, n - Resposta) ~ ldose + Trat
## Model 3: cbind(Resposta, n - Resposta) ~ ldose * Trat
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)    
## 1        16    246.832                         
## 2        14     21.282  2  225.550   &lt;2e-16 ***
## 3        12     17.890  2    3.392   0.1834    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Repare, olhando para as duas primeiras linhas, que os modelos de retas coincidentes e retas paralelas produzem desvios significativamente diferentes. Nesse caso, dentre os dois modelos, optamos pelo não restrito (retas paralelas). No entanto, ao observar as duas últimas linhas, verificamos que os dois ajustes produzem desvios que não apresentam diferença significativa. Nesse caso, podemos optar pelo modelo restrito (retas paralelas). Pela análise dos desvios, baseado nos TRVs, o modelo de retas paralelas (efeito de tratamento no intercepto) é preferível.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">AIC</span>(ajuste4,ajuste5,ajuste6)</a></code></pre></div>
<pre><code>##         df       AIC
## ajuste4  2 314.30301
## ajuste5  4  92.75286
## ajuste6  6  93.36065</code></pre>
<p>Repare que também através dos AICs tem-se indicativo de melhor ajuste para o modelo de retas paralelas.</p>
<p>Observando os resultados do summary, verifica-se que o modelo de retas paralelas tem deviance 21,282, associado a 14 graus de liberdade. Vamos testar a qualidade do ajuste.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">pchisq</span>(<span class="fl">21.282</span>, <span class="dv">14</span>, <span class="dt">lower.tail =</span> F) </a></code></pre></div>
<pre><code>## [1] 0.09462121</code></pre>
<p>Ao nível de significância de 5% não se tem evidência significativa de falta de ajuste.</p>
<p>Exercício - Para o modelo escolhido:</p>
<p>1- Escrever o modelo ajustado na escala do preditor, da chance e da probabilidade de resposta; 2- Interpretar as estimativas dos parâmetros do modelo; 3- Obter ICs 95% para os parâmetros do modelo; 4- Estimar a probabilidade de morte para doses de 3 e 7 unidades para cada tratamento. 5- Obter ICs 95% para as probabilidades mencionadas no item anterior; 6- Estimar, para cada tratamento, as doses letais 50% e 90%; 7- Fazer uma análise de diagnóstico, baseada na avaliação dos resíduos e de medidas de influência.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
